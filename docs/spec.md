# UI 自动化 Demo 项目规格文档

## 1. 产品需求

### 1.1 解决什么问题

- 缺乏自动化回归测试，每次发版需要手动验证核心功能
- 测试结果无法及时通知团队，问题发现滞后
- 没有可视化的测试报告，排查问题困难

### 1.2 目标用户

- QA 工程师：编写和维护自动化测试用例
- 开发人员：查看测试结果，定位失败原因
- 项目负责人：了解每次构建的质量状态

### 1.3 核心功能列表（MVP）

| 功能 | 描述 | 优先级 |
|------|------|--------|
| 模拟登录页面 | 本地 HTML 登录页面，作为测试环境 | P0 |
| UI 自动化测试 | 使用 Selenium 模拟用户操作，验证登录功能 | P0 |
| 浏览器模式切换 | 支持有头/无头模式切换，方便调试和 CI 运行 | P0 |
| Allure 测试报告 | 生成美观、详细的 HTML 测试报告 | P0 |
| Jenkins 集成 | 自动触发测试、收集结果、托管报告 | P0 |
| 钉钉通知 | 构建完成后推送状态和报告链接到钉钉群 | P0 |

### 1.4 用户交互流程

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  代码提交    │────▶│ Jenkins 触发 │────▶│  执行测试   │────▶│ 生成报告    │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                                                                   │
                                                                   ▼
                                        ┌─────────────┐     ┌─────────────┐
                                        │  查看报告   │◀────│ 钉钉通知    │
                                        └─────────────┘     └─────────────┘
```

**详细流程：**

1. 开发人员提交代码 / 手动触发 Jenkins 任务
2. Jenkins 拉取最新代码
3. 安装 Python 依赖
4. 执行 pytest 测试用例（Selenium Headless 模式）
5. 生成 Allure 测试报告
6. 调用钉钉 Webhook 发送通知
7. 团队成员点击链接查看详细报告

---

## 2. 技术需求

### 2.1 技术栈选择

| 类别 | 技术选型 | 说明 |
|------|----------|------|
| 编程语言 | Python 3.9+ | 主流、生态丰富 |
| 测试框架 | pytest | 灵活、插件多 |
| UI 自动化 | Selenium 4.x | 成熟稳定 |
| 浏览器 | Chrome (Headless) | 适配 CI 环境 |
| 测试报告 | Allure | 美观、功能强大 |
| CI/CD | Jenkins | 本地 Mac 已部署 |
| 通知 | 钉钉 Webhook | 已配置测试通过 |

### 2.2 项目结构建议

```
ui-automation-demo/
├── docs/
│   └── spec.md                 # 本规格文档
├── test_site/
│   ├── index.html              # 模拟登录页面（测试环境）
│   └── welcome.html            # 登录成功页面
├── tests/
│   ├── __init__.py
│   ├── conftest.py             # pytest 配置、浏览器初始化
│   └── test_login.py           # 登录功能测试用例
├── pages/
│   ├── __init__.py
│   ├── base_page.py            # Page Object 基类
│   └── login_page.py           # 登录页面对象
├── utils/
│   ├── __init__.py
│   └── dingtalk.py             # 钉钉通知封装
├── config/
│   └── config.py               # 配置文件（浏览器模式、URL 等）
├── reports/                    # Allure 结果目录（gitignore）
├── requirements.txt            # Python 依赖
├── pytest.ini                  # pytest 配置
├── Jenkinsfile                 # Pipeline 配置
└── README.md                   # 项目说明
```

### 2.3 测试环境（模拟登录页面）

本项目包含一个本地 HTML 登录页面作为被测系统：

**功能说明：**
- 登录表单：用户名、密码输入框，登录按钮
- 表单验证：空值校验、错误提示
- 登录成功：跳转到欢迎页面
- 测试账号：`admin` / `123456`

**测试场景覆盖：**
| 场景 | 输入 | 预期结果 |
|------|------|----------|
| 正确登录 | admin / 123456 | 跳转到欢迎页 |
| 密码错误 | admin / wrong | 提示"用户名或密码错误" |
| 用户名为空 | 空 / 123456 | 提示"请输入用户名" |
| 密码为空 | admin / 空 | 提示"请输入密码" |

### 2.4 浏览器模式切换

支持通过环境变量或配置文件切换浏览器运行模式：

| 模式 | 使用场景 | 配置方式 |
|------|----------|----------|
| **有头模式** | 本地调试，查看执行过程 | `HEADLESS=false` |
| **无头模式** | Jenkins CI，后台静默运行 | `HEADLESS=true`（默认） |

**切换方式：**
```bash
# 本地调试（有头模式，弹出浏览器）
HEADLESS=false pytest tests/

# Jenkins CI（无头模式，后台运行）
HEADLESS=true pytest tests/
```

### 2.5 第三方服务/API

| 服务 | 用途 | 配置方式 |
|------|------|----------|
| Chrome + ChromeDriver | 执行 UI 自动化 | 本地安装，版本需匹配 |
| Jenkins Allure 插件 | 生成并托管测试报告 | 已安装 |
| 钉钉 Webhook | 发送构建通知 | 机器人 URL 配置为环境变量 |

### 2.6 环境变量

| 变量名 | 说明 | 示例 |
|--------|------|------|
| `DINGTALK_WEBHOOK` | 钉钉机器人 Webhook 地址 | `https://oapi.dingtalk.com/robot/send?access_token=xxx` |
| `JENKINS_URL` | Jenkins 访问地址 | `http://localhost:8080` |
| `HEADLESS` | 浏览器模式（true=无头，false=有头） | `true`（默认） |

---

## 3. 后续步骤

文档确认后，将输出以下内容：

1. **完整项目代码**：所有目录和文件
2. **Jenkinsfile**：Pipeline 配置
3. **钉钉通知脚本**：封装好的发送函数
4. **README.md**：本地运行和 Jenkins 配置指南
